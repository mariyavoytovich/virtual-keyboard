(()=>{"use strict";(()=>{class e{createElement(){}createDomNode(e,...t){const s=document.createElement(e);return s.classList.add(...t),s}init(){}}class t extends e{_elements=[];show(e,t){const s=this.createElement(t)??e;for(let e of this._elements)e.show(s,t);s!==e&&e.append(s)}addElements(...e){this._elements.push(...e)}addElement(e){this._elements.push(e)}init(){this._elements.forEach((e=>e.init()))}refresh(e){this._elements.forEach((t=>t.refresh(e)))}}class s extends t{createElement(){return this.createDomNode("div","wrapper")}}class i extends e{_contentWrapper=new s;constructor(){super()}show(e,t){const s=this.createElement();this._contentWrapper.show(s,t),e.append(s)}createElement(){return this.createDomNode("section")}addElements(...e){this._contentWrapper.addElements(...e)}init(){this._contentWrapper.init()}}class n extends e{show(e,t){const s=this.createElement(t);e.append(s)}}class y extends n{_textArea;createElement(){const e=this.createDomNode("div","text-editor__container"),t=this.createDomNode("textarea","text-editor");return t.setAttribute("rows",5),e.append(t),this._textArea=t,e}print(e){const t=this._textArea.selectionStart,s=this._textArea.value,i=s.length===t?this.appendValue(s,e):this.insertValue(s,e,t);this._textArea.value=i;const n=t+e.length;this.setTextAreaSelection(n),this.focus()}appendValue(e,t){return`${e}${t}`}insertValue(e,t,s){return`${e.substring(0,s)}${t}${e.substring(s)}`}setTextAreaSelection(e,t){t||(t=e),this._textArea.setSelectionRange(e,t)}focus(){this._textArea.focus()}removeLeft(){const e=this._textArea.selectionStart;if(0===e)return;const t=e-1;this.removeAt(t)}removeAt(e){this.removeChar(e),this.setTextAreaSelection(e),this.focus()}removeChar(e){const t=this._textArea.value,s=t.substring(0,e),i=t.substring(e+1);this._textArea.value=`${s}${i}`}removeRight(){const e=this._textArea.selectionStart;if(e===this._textArea.value.length)return;const t=e;this.removeAt(t)}}const o="case-up",a="case-down",h="Backquote",r="Digit1",l="Digit2",c="Digit3",k="Digit4",d="Digit5",u="Digit6",f="Digit7",p="Digit8",K="Digit9",g="Digit0",m="Minus",T="Equal",E="Backspace",_="Tab",B="KeyQ",b="KeyW",x="KeyE",w="KeyR",v="KeyT",C="KeyY",D="KeyU",L="KeyI",A="KeyO",H="KeyP",S="BracketLeft",N="BracketRight",$="Backslash",R="CapsLock",W="KeyA",U="KeyS",q="KeyD",P="KeyF",V="KeyG",I="KeyH",M="KeyJ",O="KeyK",Q="KeyL",F="Semicolon",G="Quote",J="Enter",X="ShiftLeft",Y="KeyZ",Z="KeyX",j="KeyC",z="KeyV",ee="KeyB",te="KeyN",se="KeyM",ie="Comma",ne="Period",ye="Slash",oe="ArrowUp",ae="ShiftRight",he="ControlLeft",re="MetaLeft",le="AltLeft",ce="Space",ke="AltRight",de="ControlRight",ue="ArrowLeft",fe="ArrowDown",pe="ArrowRight",Ke="Delete",ge="eng",me={ru:{[h]:{key:"ё",shiftKey:"Ё"},[r]:{key:"1",shiftKey:"!"},[l]:{key:"2",shiftKey:'"'},[c]:{key:"3",shiftKey:"№"},[k]:{key:"4",shiftKey:";"},[d]:{key:"5",shiftKey:"%"},[u]:{key:"6",shiftKey:":"},[f]:{key:"7",shiftKey:"?"},[p]:{key:"8",shiftKey:"*"},[K]:{key:"9",shiftKey:"("},[g]:{key:"0",shiftKey:")"},[m]:{key:"-",shiftKey:"_"},[T]:{key:"=",shiftKey:"+"},[E]:{key:"Backspace",shiftKey:"Backspace"},[_]:{key:"Tab",shiftKey:"Tab"},[B]:{key:"й",shiftKey:"Й"},[b]:{key:"ц",shiftKey:"Ц"},[x]:{key:"у",shiftKey:"У"},[w]:{key:"к",shiftKey:"К"},[v]:{key:"е",shiftKey:"Е"},[C]:{key:"н",shiftKey:"Н"},[D]:{key:"г",shiftKey:"Г"},[L]:{key:"ш",shiftKey:"Ш"},[A]:{key:"щ",shiftKey:"Щ"},[H]:{key:"з",shiftKey:"З"},[S]:{key:"х",shiftKey:"Х"},[N]:{key:"ъ",shiftKey:"Ъ"},[$]:{key:"\\",shiftKey:"/"},[R]:{key:"Caps Lock",shiftKey:"Caps Lock"},[W]:{key:"ф",shiftKey:"Ф"},[U]:{key:"ы",shiftKey:"Ы"},[q]:{key:"в",shiftKey:"В"},[P]:{key:"а",shiftKey:"А"},[V]:{key:"п",shiftKey:"П"},[I]:{key:"р",shiftKey:"Р"},[M]:{key:"о",shiftKey:"О"},[O]:{key:"л",shiftKey:"Л"},[Q]:{key:"д",shiftKey:"Д"},[F]:{key:"ж",shiftKey:"Ж"},[G]:{key:"э",shiftKey:"Э"},[J]:{key:"Enter",shiftKey:"Enter"},[X]:{key:"Shift",shiftKey:"Shift"},[Y]:{key:"я",shiftKey:"Я"},[Z]:{key:"ч",shiftKey:"Ч"},[j]:{key:"с",shiftKey:"С"},[z]:{key:"м",shiftKey:"М"},[ee]:{key:"и",shiftKey:"И"},[te]:{key:"т",shiftKey:"Т"},[se]:{key:"ь",shiftKey:"Ь"},[ie]:{key:"б",shiftKey:"Б"},[ne]:{key:"ю",shiftKey:"Ю"},[ye]:{key:".",shiftKey:","},[oe]:{key:"▲",shiftKey:"▲"},[ae]:{key:"Shift",shiftKey:"Shift"},[he]:{key:"Ctrl",shiftKey:"Ctrl"},[re]:{key:"Win",shiftKey:"Win"},[le]:{key:"Alt",shiftKey:"Alt"},[ke]:{key:"Alt",shiftKey:"Alt"},[ce]:{key:"",shiftKey:""},[de]:{key:"Ctrl",shiftKey:"Ctrl"},[ue]:{key:"◄",shiftKey:"◄"},[fe]:{key:"▼",shiftKey:"▼"},[pe]:{key:"►",shiftKey:"►"},[Ke]:{key:"Del",shiftKey:"Del"}},[ge]:{[h]:{key:"`",shiftKey:"~"},[r]:{key:"1",shiftKey:"!"},[l]:{key:"2",shiftKey:"@"},[c]:{key:"3",shiftKey:"#"},[k]:{key:"4",shiftKey:"$"},[d]:{key:"5",shiftKey:"%"},[u]:{key:"6",shiftKey:"^"},[f]:{key:"7",shiftKey:"&"},[p]:{key:"8",shiftKey:"*"},[K]:{key:"9",shiftKey:"("},[g]:{key:"0",shiftKey:")"},[m]:{key:"-",shiftKey:"_"},[T]:{key:"=",shiftKey:"+"},[E]:{key:"Backspace",shiftKey:"Backspace"},[_]:{key:"Tab",shiftKey:"Tab"},[B]:{key:"q",shiftKey:"Q"},[b]:{key:"w",shiftKey:"W"},[x]:{key:"e",shiftKey:"E"},[w]:{key:"r",shiftKey:"R"},[v]:{key:"t",shiftKey:"T"},[C]:{key:"y",shiftKey:"Y"},[D]:{key:"u",shiftKey:"U"},[L]:{key:"i",shiftKey:"I"},[A]:{key:"o",shiftKey:"O"},[H]:{key:"p",shiftKey:"P"},[S]:{key:"[",shiftKey:"{"},[N]:{key:"]",shiftKey:"}"},[$]:{key:"\\",shiftKey:"|"},[R]:{key:"Caps Lock",shiftKey:"Caps Lock"},[W]:{key:"a",shiftKey:"A"},[U]:{key:"s",shiftKey:"S"},[q]:{key:"d",shiftKey:"D"},[P]:{key:"f",shiftKey:"F"},[V]:{key:"g",shiftKey:"G"},[I]:{key:"h",shiftKey:"H"},[M]:{key:"j",shiftKey:"J"},[O]:{key:"k",shiftKey:"K"},[Q]:{key:"l",shiftKey:"L"},[F]:{key:";",shiftKey:":"},[G]:{key:"'",shiftKey:'"'},[J]:{key:"Enter",shiftKey:"Enter"},[X]:{key:"Shift",shiftKey:"Shift"},[Y]:{key:"z",shiftKey:"Z"},[Z]:{key:"x",shiftKey:"X"},[j]:{key:"c",shiftKey:"C"},[z]:{key:"v",shiftKey:"V"},[ee]:{key:"b",shiftKey:"B"},[te]:{key:"n",shiftKey:"N"},[se]:{key:"m",shiftKey:"M"},[ie]:{key:",",shiftKey:"<"},[ne]:{key:".",shiftKey:">"},[ye]:{key:"/",shiftKey:"?"},[oe]:{key:"▲",shiftKey:"▲"},[ae]:{key:"Shift",shiftKey:"Shift"},[he]:{key:"Ctrl",shiftKey:"Ctrl"},[re]:{key:"Win",shiftKey:"Win"},[le]:{key:"Alt",shiftKey:"Alt"},[ke]:{key:"Alt",shiftKey:"Alt"},[ce]:{key:"",shiftKey:""},[de]:{key:"Ctrl",shiftKey:"Ctrl"},[ue]:{key:"◄",shiftKey:"◄"},[fe]:{key:"▼",shiftKey:"▼"},[pe]:{key:"►",shiftKey:"►"},[Ke]:{key:"Del",shiftKey:"Del"}}},Te=(e,t)=>me[t][e],Ee="keyboard-button",_e="button",Be="pressed";class be extends n{constructor(e,t,s){super(),this._code=e,this._location=t,this._keyType=s}createElement(e){const t=[Ee,_e,`${this._keyType}-${_e}`,this._location,this._code],s=this.createDomNode("div",...t);s.setAttribute("type",this._keyType);const{key:i,shiftKey:n}=Te(this._code,e);return this._keyDown=this.createKeyElement(i,a),this._keyUp=this.createKeyElement(n,o),s.append(this._keyDown),s.append(this._keyUp),s}createKeyElement(e,t){const s=this.createDomNode("span",t);return s.textContent=e,s}refresh(e){this.updatesKeysElements(e)}updatesKeysElements(e){const{key:t,shiftKey:s}=Te(this._code,e);this._keyDown.textContent=t,this._keyUp.textContent=s}}const xe="key",we="backspace",ve="caps-lock",Ce="enter",De="shift",Le="arrow",Ae="control",He="space",Se="delete",Ne="general-keys",$e="left-side-modifier-keys",Re="right-side-modifier-keys",We={[h]:{location:Ne,keyType:xe},[r]:{location:Ne,keyType:xe},[l]:{location:Ne,keyType:xe},[c]:{location:Ne,keyType:xe},[k]:{location:Ne,keyType:xe},[d]:{location:Ne,keyType:xe},[u]:{location:Ne,keyType:xe},[f]:{location:Ne,keyType:xe},[p]:{location:Ne,keyType:xe},[K]:{location:Ne,keyType:xe},[g]:{location:Ne,keyType:xe},[m]:{location:Ne,keyType:xe},[T]:{location:Ne,keyType:xe},[E]:{location:Ne,keyType:we},[_]:{location:Ne,keyType:"tab"},[B]:{location:Ne,keyType:xe},[b]:{location:Ne,keyType:xe},[x]:{location:Ne,keyType:xe},[w]:{location:Ne,keyType:xe},[v]:{location:Ne,keyType:xe},[C]:{location:Ne,keyType:xe},[D]:{location:Ne,keyType:xe},[L]:{location:Ne,keyType:xe},[A]:{location:Ne,keyType:xe},[H]:{location:Ne,keyType:xe},[S]:{location:Ne,keyType:xe},[N]:{location:Ne,keyType:xe},[$]:{location:Ne,keyType:xe},[R]:{location:Ne,keyType:ve},[W]:{location:Ne,keyType:xe},[U]:{location:Ne,keyType:xe},[q]:{location:Ne,keyType:xe},[P]:{location:Ne,keyType:xe},[V]:{location:Ne,keyType:xe},[I]:{location:Ne,keyType:xe},[M]:{location:Ne,keyType:xe},[O]:{location:Ne,keyType:xe},[Q]:{location:Ne,keyType:xe},[F]:{location:Ne,keyType:xe},[G]:{location:Ne,keyType:xe},[J]:{location:$e,keyType:Ce},[X]:{location:$e,keyType:De},[Y]:{location:Ne,keyType:xe},[Z]:{location:Ne,keyType:xe},[j]:{location:Ne,keyType:xe},[z]:{location:Ne,keyType:xe},[ee]:{location:Ne,keyType:xe},[te]:{location:Ne,keyType:xe},[se]:{location:Ne,keyType:xe},[ie]:{location:Ne,keyType:xe},[ne]:{location:Ne,keyType:xe},[ye]:{location:Ne,keyType:xe},[oe]:{location:Ne,keyType:Le},[ae]:{location:Re,keyType:De},[he]:{location:$e,keyType:Ae},[re]:{location:$e,keyType:"meta"},[le]:{location:$e,keyType:"alt"},[ce]:{location:Ne,keyType:He},[ke]:{location:Re,keyType:"alt"},[de]:{location:Re,keyType:Ae},[ue]:{location:Ne,keyType:Le},[fe]:{location:Ne,keyType:Le},[pe]:{location:Ne,keyType:Le},[Ke]:{location:Ne,keyType:Se}};class Ue extends t{constructor(e,t){super(),this.id=e,this.buttons=t}init(){this.createButtons(),super.init()}createButtons(){this.buttons.forEach((e=>{const{location:t,keyType:s}=We[e],i=new be(e,t,s);this.addElement(i)}))}createElement(){return this.createDomNode("div","keyboard-row","row")}}const qe={languages:[ge,"ru"],defaultLanguage:ge,defaultKeyCase:a},Pe=[{id:0,buttons:[h,r,l,c,k,d,u,f,p,K,g,m,T,E]},{id:1,buttons:[_,B,b,x,w,v,C,D,L,A,H,S,N,$,Ke]},{id:2,buttons:[R,W,U,q,P,V,I,M,O,Q,F,G,J]},{id:3,buttons:[X,Y,Z,j,z,ee,te,se,ie,ne,ye,oe,ae]},{id:4,buttons:[he,re,le,ce,ke,de,ue,fe,pe]}],Ve="hidden",Ie="lang";class Me extends t{_eventHandlers;_keyboard;constructor(e){super(),this._textEditor=e,this.state={case:qe.defaultKeyCase,language:qe.defaultLanguage,languages:qe.languages}}init(){this.initLanguage(),this.createRows(),this._eventHandlers=this.getButtonHandlers(),super.init()}initLanguage(){const e=localStorage.getItem(Ie);e&&(this.state.language=e)}createRows(){for(let{id:e,buttons:t}of Pe){const s=new Ue(e,t);this.addElement(s)}}show(e){super.show(e,this.state.language),this.toggleButtonsCharacterCase()}createElement(){const e=this.createDomNode("div","virtual-keyboard");return this.bindKeyboardEvents(e),this._keyboard=e,e}bindKeyboardEvents(e){e.addEventListener("mousedown",(e=>this.mouseDownEventHandler(e))),e.addEventListener("mouseup",(e=>this.mouseUpEventHandler(e))),document.addEventListener("keyup",(e=>this.keyUpEventHandler(e))),document.addEventListener("keydown",(e=>this.keyDownEventHandler(e)))}keyUpEventHandler(e){const t=e.code,s=this._keyboard.querySelector(`.${t}`);s&&this.unpressButtonHandler(s)}keyDownEventHandler(e){e.preventDefault();const t=e.code,s=this._keyboard.querySelector(`.${t}`);s&&this.pressButtonHandler(s,e)}mouseDownEventHandler(e){const t=this.getTargetElement(e);this.isButton(t)&&(this.pressButtonHandler(t,e),e.preventDefault())}pressButtonHandler(e,t){const s=t.repeat,i=this.getButtonType(e);switch(i){case ve:s||(this.togglePress(e),this.handleButton(e,i));break;case De:s||(this.pressButton(e),this.handleButton(e,i));break;default:!s&&this.pressButton(e),this.handleButton(e,i)}!s&&t.altKey&&t.ctrlKey&&this.toggleLanguage()}buttonIsPressed(e){return e.classList.contains(Be)}handleButton(e,t){const s=this.getButtonHandler(t);s&&s(e)}pressButton(e){e.classList.add(Be)}togglePress(e){e.classList.toggle(Be)}mouseUpEventHandler(e){const t=this.getTargetElement(e);this.isButton(t)&&this.unpressButtonHandler(t)}unpressButtonHandler(e){const t=this.getButtonType(e);t!==ve&&(t===De&&this.handleButton(e,t),this.unpressButton(e))}unpressButton(e){e.classList.remove(Be)}getTargetElement(e){const t=e.target;return"SPAN"===t.tagName?t.closest("div"):t}isButton(e){return e.classList.contains(Ee)}getButtonHandler(e){return this._eventHandlers[e]}getButtonHandlers(){const e={[xe]:this.keyButtonHandler.bind(this),[we]:this.backspaceButtonHandler.bind(this),[ve]:this.capsLockButtonHandler.bind(this),[Ce]:this.enterButtonHandler.bind(this),[He]:this.spaceButtonHandler.bind(this),tab:this.tabButtonHandler.bind(this),[De]:this.shiftButtonHandler.bind(this),[Se]:this.deleteButtonHandler.bind(this)};return e[Le]=e[xe],e}keyButtonHandler(e){const t=e.querySelector(`.${this.state.case}`);this._textEditor.print(t.textContent)}backspaceButtonHandler(){this._textEditor.removeLeft()}deleteButtonHandler(){this._textEditor.removeRight()}spaceButtonHandler(){this._textEditor.print(" ")}capsLockButtonHandler(){this.toggleCase(),this.toggleButtonsCharacterCase()}shiftButtonHandler(){this.toggleCase(),this.toggleButtonsCharacterCase()}enterButtonHandler(){this._textEditor.print("\n")}tabButtonHandler(){this._textEditor.print("    ")}toggleButtonsCharacterCase(){this._keyboard.querySelectorAll(`.${Ee} span`).forEach((e=>{e.classList.contains(this.state.case)?this.showElement(e):this.hideElement(e)}))}hideElement(e){e.classList.add(Ve)}showElement(e){e.classList.remove(Ve)}toggleCase(){const e=this.state.case===o?a:o;this.state.case=e}getButtonType(e){return e.getAttribute("type")}toggleLanguage(){const e=this.getNextLanguage();this.state.language=e,this.saveLanguage(),this.refresh(this.state.language)}getNextLanguage(){const e=this.state.language;let t=this.state.languages.indexOf(e)+1;return t>=this.state.languages.length&&(t=0),this.state.languages[t]}saveLanguage(){localStorage.setItem(Ie,this.state.language)}}class Oe extends t{show(){const e=document.querySelector(".body");super.show(e)}}class Qe extends i{createElement(){return this.createDomNode("footer","footer")}}class Fe extends n{constructor(e,t){super(),this._text=e,this._cssClasses=t}createElement(){const e=this.createDomNode("p",...this._cssClasses);return e.textContent=this._text,e}}class Ge extends Qe{init(){const e=new Fe("Клавиатура создана в операционной системе Windows",["description"]),t=new Fe("Для переключения языка комбинация: ctrl + alt",["language"]);this._contentWrapper.addElements(e,t),super.init()}}class Je extends n{constructor(e,t){super(),this._level=e,this._tetxt=t}createElement(){const e=this.createDomNode(`h${this._level}`,"heading");return e.textContent=this._tetxt,e}}class Xe extends i{init(){const e=new Je(1,"RSS Виртуальная клавиатура");this._contentWrapper.addElement(e)}createElement(){return this.createDomNode("header","header")}}new class{constructor(){this.initElements()}initElements(){const e=new Oe,t=new Xe,s=new y,n=new Me(s),o=new i(!0);o.addElements(s,n);const a=new Ge;e.addElements(t,o,a),e.init(),e.show()}}})()})();